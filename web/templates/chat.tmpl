{{template "layout.tmpl" .}}

{{define "content"}}
<main class="container">
    {{$otherUser := .Chat.Participation.OtherUser}}
    <h1>Chat with <a href="/u/{{$otherUser.Username}}">{{$otherUser.Username}}</a></h1>

    <div class="chat-messages" aria-live="polite" aria-relevant="additions">
        {{range .Messages.Items}}
            <div class="chat-message{{if .Relationship.IsMine}} chat-message-mine{{end}}">
                {{if not .Relationship.IsMine}}
                    <a href="/u/{{.User.Username}}" class="chat-message-avatar">
                        {{template "avatar.tmpl" .User}}
                    </a>
                {{end}}
                <div class="chat-message-content">
                    <div class="chat-message-bubble">
                        {{if not .Relationship.IsMine}}
                            <a href="/u/{{.User.Username}}" class="chat-message-username">{{.User.Username}}</a>
                        {{end}}
                        <p class="chat-message-text">{{.Content | linkify}}</p>
                    </div>
                    <time class="chat-message-time" datetime='{{.CreatedAt.Format "2006-01-02T15:04:05Z07:00"}}'>{{.CreatedAt.Format "15:04"}}</time>
                </div>
            </div>
        {{end}}
    </div>

    <form action="/messages" method="post" class="chat-form">
        <input type="hidden" name="chat_id" value="{{.Chat.ID}}">
        <input type="text" name="message" placeholder="Type your message..." autocomplete="off" autofocus required>
        <button type="submit" class="primary">
            <svg width="24px" height="24px" viewBox="0 0 24 24" stroke-width="1.5" fill="none" xmlns="http://www.w3.org/2000/svg" color="#000000" style="--darkreader-inline-color: #e8e6e3;" data-darkreader-inline-color=""><path d="M22.1525 3.55321L11.1772 21.0044L9.50686 12.4078L2.00002 7.89795L22.1525 3.55321Z" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="--darkreader-inline-stroke: #000000;" data-darkreader-inline-stroke=""></path><path d="M9.45557 12.4436L22.1524 3.55321" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="--darkreader-inline-stroke: #000000;" data-darkreader-inline-stroke=""></path></svg>
        </button>
    </form>
</main>
{{end}}