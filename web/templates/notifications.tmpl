{{template "layout.tmpl" .}}

{{define "content"}}
<main class="container">
    <h1>Notifications</h1>

    {{if not .Notifications.Items}}
        <div class="info">
            <p>No notifications available</p>
        </div>
    {{else}}
        {{template "load-prev.tmpl" (dict
            "URL" .Request.URL
            "PageInfo" .Notifications.PageInfo
        )}}

        <div role="feed">
            {{range .Notifications.Items}}
                <article class="card notification {{if .Read}} notification-read{{end}}" data-notification-kind="{{.Kind.String}}">
                    {{$lastActor := index .Actors 0}}
                    <a href="/u/{{$lastActor.Username}}" class="notification-avatar">
                        {{template "avatar.tmpl" $lastActor}}
                    </a>

                    {{if eq .Kind.String "follow"}}
                        <p class="notification-message">{{template "actors" .}} followed you.</p>
                    {{else if eq .Kind.String "post_mention"}}
                        <p class="notification-message">{{template "actors" .}} mentioned you in a <a href="/p/{{.Post.ID}}">post</a>.</p>
                    {{else if eq .Kind.String "comment_mention"}}
                        <p class="notification-message">{{template "actors" .}} mentioned you in a <a href="/p/{{.Comment.PostID}}#comment-{{.Comment.ID}}">comment</a>.</p>
                    {{else if eq .Kind.String "comment"}}
                        <p class="notification-message">{{template "actors" .}} <a href="/p/{{.Comment.PostID}}#comment-{{.Comment.ID}}">commented</a>.</p>
                    {{end}}

                    {{if not .Read}}
                        <form action="/notifications/{{.ID}}/read" method="POST" class="notification-mark-read">
                            <button aria-label="Mark as read" title="Mark as read">
                                <svg width="24px" height="24px" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" color="#000000" style="--darkreader-inline-color: var(--darkreader-text-000000, #e8e6e3);" data-darkreader-inline-color=""><path d="M5 13L9 17L19 7" stroke="#000000" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="--darkreader-inline-stroke: #000000;" data-darkreader-inline-stroke=""></path></svg>
                            </button>
                        </form>
                    {{end}}

                    {{if eq .Kind.String "post_mention"}}
                        {{template "post-preview" .Post}}
                    {{else if eq .Kind.String "comment_mention"}}
                        {{template "comment-preview" .Comment}}
                    {{else if eq .Kind.String "comment"}}
                        {{template "comment-preview" .Comment}}
                    {{end}}

                    <time class="notification-time" datetime='{{.CreatedAt.Format "2006-01-02T15:04:05Z07:00"}}'>{{.CreatedAt.Format "2006-01-02 15:04:05"}}</time>

                    
                </article>
            {{end}}
        </div>

        {{template "load-more.tmpl" (dict
            "URL" .Request.URL
            "PageInfo" .Notifications.PageInfo
        )}}
    {{end}}
</main>
{{end}}

{{define "actors"}}
{{if eq .ActorsCount 1}}
    {{- $actor := (index .Actors 0) -}}
    {{template "actor" $actor}}
{{else if eq .ActorsCount 2}}
    {{- $actorA := index .Actors 0}}
    {{- $actorB := index .Actors 1}}
    {{template "actor" $actorA}} and {{template "actor" $actorB}}
{{else if gt .ActorsCount 2}}
    {{- $actorA := index .Actors 0}}
    {{- $actorB := index .Actors 1}}
    {{template "actor" $actorA}}, {{template "actor" $actorB}} and {{plus .ActorsCount -2}} others
{{end}}
{{end}}

{{define "actor"}}
<a href="/u/{{.Username}}" class="primary">{{.Username}}</a>
{{end}}

{{define "post-preview"}}
{{if .Content}}
    <a href="/p/{{.ID}}" class="post-preview-link">
        <p class="post-preview-content">{{.Content}}</p>
    </a>
{{else if .Attachments}}
    {{with index .Attachments 0}}
    <a href="/p/{{$.ID}}" class="post-preview-link">
        <img class="post-preview-attachment" src="{{minio "post-attachments" .Path}}" width="{{.Width}}" height="{{.Height}}" alt="Post Attachment">
    </a>
    {{end}}
{{end}}
{{end}}

{{define "comment-preview"}}
{{if .Content}}
    <a href="/p/{{.PostID}}#comment-{{.ID}}" class="comment-preview-link">
        <p class="comment-preview-content">{{.Content}}</p>
    </a>
{{else if .Attachment}}
    {{with .Attachment}}
    <a href="/p/{{$.PostID}}#comment-{{$.ID}}" class="comment-preview-link">
        <img class="comment-preview-attachment" src="{{minio "comment-attachments" .Path}}" width="{{.Width}}" height="{{.Height}}" alt="Comment Attachment">
    </a>
    {{end}}
{{end}}
{{end}}